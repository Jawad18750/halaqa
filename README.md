# حلقة — منصة اختبار القرآن الكريم

هذا مشروع مفتوح المصدر يسهّل على الشيخ إدارة طلابه وإجراء اختبارات الحفظ الأسبوعية وفق نظام النقزات والأجزاء، مع سجل تاريخي لكل طالب ولوحة أسبوعية عامة. الواجهة عربية بالكامل ومصممة أولًا للهاتف.

المشروع متاح للاستخدام مجانًا على: https://halaqa.abdeljawad.com/

تم تطوير المنصة بواسطة عبدالجواد الميلادي. لا تنسوني من صالح دعائكم لي ولوالديّ ولأسرتي. أنا منفتح على الاقتراحات والتحسينات في أي وقت.

---

## ما هي المنصة؟
- تسجيل حساب للشيخ وتسجيل الدخول بحساب خاص (اسم المستخدم أو البريد الإلكتروني).
- إضافة طلاب برقم فريد واسم وتاريخ ميلاد وصورة شخصية.
- لكل طالب نقزة حالية تبدأ من 20 وتنخفض عند النجاح.
- أثناء الحلقة يمكن إجراء اختبار عشوائي للطالب:
  - حسب النقزة الحالية افتراضيًا.
  - أو حسب الجزء عند الحاجة لبعض الطلاب.
  - أو خمسة أحزاب أو ربع القرآن أو نصف القرآن أو القرآن كامل.
  - يُمنع تكرار نفس الثمن مباشرةً فقط، وما عدا ذلك فالاختيار عشوائي بالكامل.
- بعد الاختبار تُسجّل بيانات المحاولة: الثمن المختار، عدد الفتحة، عدد التردد، نجاح أو رسوب، درجة رقمية وتقدير لفظي، التاريخ والوقت.
- تاريخ لكل طالب مع إمكانية تعديل وقت المحاولة (خلال 30 يوم) + نظرة زمنية لجميع محاولات الفترة المحددة.
- إمكانية تصدير التقارير بصيغة PDF و Excel.
- وضع ضيف للاختبار بدون تسجيل دخول.

---

## قواعد النجاح والدرجة باختصار
- الفتحة حتى 3 مرات لا تُسقط الطالب، وعند الرابعة يكون الفشل تلقائيًا.
- التردد يُحسب للمتابعة ولا يُسقط الطالب.
- الدرجات:
  - في حال النجاح: درجة بين 60 و100 تراعي عدد الفتحة والتردد.
  - في حال الرسوب: درجة أقل من 60.
- التقديرات: ممتاز، جيد جدًا، جيد، مقبول، ضعيف.
- التقدم الأسبوعي: عند أي نجاح يُنقص رقم النقزة الحالية بمقدار 1 مباشرةً. عند رسوب يوم الأحد يبقى الطالب على نفس النقزة للأسبوع التالي.

---

## البنية العامة للمشروع
```
QuranTester/
├─ quran-tester-app/                 واجهة المستخدم (React 18 + Vite)
│  ├─ src/components/               مكونات React (Auth, Students, TestView, etc.)
│  └─ public/quran-thumun-data.json  الملف المرجعي لجميع الأثمان (480 ثمن)
├─ server/                           الخادم (Node.js + Express + PostgreSQL)
│  ├─ src/routes/                   واجهات برمجية (auth, students, sessions)
│  ├─ src/db/migrations/            ترحيلات قاعدة البيانات SQL
│  └─ src/uploads/                  صور الطلاب
└─ quran-tester-deployment/         حزمة النشر اليدوي
```
- الواجهة تعتمد على ملف بيانات وحيد وصحيح المصدر يتضمن الأثمان مع السور والأحزاب والأجزاء والنقزات.
- الخادم يوفر واجهات برمجية آمنة باستخدام JSON Web Token، وقاعدة البيانات PostgreSQL، وإدارة الملفات.
- يدعم النظام إعادة تعيين كلمة المرور عبر البريد الإلكتروني.

---

## التشغيل محليًا
### المتطلبات
- Node.js 20 أو أحدث
- PostgreSQL 13 أو أحدث
- Docker لتشغيل PostgreSQL محليًا (مستحسن)

### الخادم
```bash
cd server
cp .env.example .env      # إعداد DATABASE_URL و JWT_SECRET و PORT=4000 و SMTP_*
docker compose up -d      # تشغيل PostgreSQL محليًا
npm install
npm run migrate           # تنفيذ الترحيلات
npm run seed              # بيانات تجريبية (اختياري)
npm run dev               # http://localhost:4000/health
```

### الواجهة
```bash
cd quran-tester-app
cp .env.example .env      # عيّن VITE_API_URL=http://localhost:4000
npm install
npm run dev               # http://localhost:5173
```

---

## الواجهات البرمجية المختصرة
الأساس: `http://localhost:4000`

- المصادقة: `POST /auth/register`، `POST /auth/login`، `GET /auth/me`، `POST /auth/forgot`، `POST /auth/reset`
- الطلاب: `GET /students`، `POST /students`، `PATCH /students/:id`، `DELETE /students/:id`، `POST /students/:id/photo`
- الجلسات:
  - `POST /sessions` لتسجيل محاولة اختبار.
  - `GET /sessions/student/:id` تاريخ طالب معين.
  - `GET /sessions/weekly` النظرة الأسبوعية الحالية.
  - `GET /sessions/overview?from=date&to=date` نظرة زمنية مخصصة.
  - `PATCH /sessions/:id/time` تعديل وقت المحاولة.
  - `DELETE /sessions/:id` حذف محاولة.

كل الطلبات (عدا التسجيل/الدخول/الوضع الضيف) تتطلب ترويسة Authorization برمز JWT.

---

## التعددية وحماية البيانات
- كل شيخ يملك بياناته الخاصة فقط. جميع الاستعلامات تُقيَّد بمعرّف المستخدم لضمان العزل بين الحسابات.
- رقم الطالب فريد داخل حساب الشيخ نفسه (بدون قيود على العدد).
- صور الطلاب محفوظة محليًا في مجلد `/uploads` مع حماية الوصول.
- يمكن لاحقًا توسيع النظام ليعمل على مستوى مؤسسة أو فريق لأن الجداول مبنية بمراجع واضحة للمستخدم.

---

## النشر والإتاحة
- يتم البناء والنشر تلقائيًا عند الدفع إلى الفرع `main` عبر GitHub Actions.
- متاح أيضًا حزمة نشر يدوي (`quran-tester-deployment.zip`) تحتوي على كل ما يلزم للنشر.
- على الخادم يتم:
  - رفع بناء الواجهة إلى مسار الإتاحة وربطه بالإصدار الحالي.
  - رفع نسخة الخادم، كتابة ملف البيئة، تشغيل الترحيلات.
  - تشغيل الخادم باستخدام PM2 مع إعادة التشغيل عند الحاجة.
- الواجهة العامة متاحة مجانًا على: https://halaqa.abdeljawad.com/

إن كنت تستخدم نطاقًا رئيسيًا وتريد تمرير الواجهة إلى واجهة برمجية فرعية، استخدم وكيلًا عكسيًا يمرر المسار `/api` إلى المنفذ 4000.

---

## المساهمة والاقتراحات
- المشروع مفتوح المصدر وأرحّب بأي اقتراح أو تحسين.
- لإضافة ميزة أو إصلاح مشكلة:
  1) افتح قضية توضّح الحاجة أو المشكلة باختصار.
  2) اقترح الحل أو افتح طلب دمج بعد اختبار التغيير محليًا.

---

## الرخصة
المشروع مفتوح المصدر ومتاح للاستخدام والتعديل مع الإشارة للمصدر. يمكن إضافة ملف LICENSE لاحقًا عند تثبيت نوع الرخصة بشكل نهائي.

---

## شكر ودعاء
هذا النظام هو فكرة للشيخ عبدالرحمن الغرياني وتم بناؤه بواسطة عبدالجواد الميلادي. لا تنسونا من صالح دعائكم لنا ولوالدينا ولأسرتنا. كما يسعدني الاطلاع على آرائكم وملاحظاتكم لتحسين العمل.

